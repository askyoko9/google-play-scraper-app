<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Play Scraper</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            margin-top: 20px;
        }

        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 10px;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
        }

        input {
            width: 100%;
            padding: 15px;
            margin-bottom: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            box-sizing: border-box;
            transition: border-color 0.3s;
        }

        input:focus {
            outline: none;
            border-color: #667eea;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        button {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        #testBtn {
            background: #34c759;
            color: white;
        }

        #scrapeBtn {
            background: #007aff;
            color: white;
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        #result {
            margin-top: 20px;
            padding: 20px;
            border-radius: 8px;
            background: #f8f9fa;
            min-height: 100px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }

        .success {
            color: #34c759;
            border-left: 4px solid #34c759;
        }

        .error {
            color: #ff3b30;
            border-left: 4px solid #ff3b30;
        }

        .info {
            color: #007aff;
            border-left: 4px solid #007aff;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #007aff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
            vertical-align: middle;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .example {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>üì± Google Play Reviews Scraper</h1>
        <p class="subtitle">–°–±–æ—Ä –æ—Ç–∑—ã–≤–æ–≤ –∏–∑ Google Play Store</p>

        <input type="text" id="urlInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–ª–∏ App ID" value="com.whatsapp">
        <div class="example">–ü—Ä–∏–º–µ—Ä—ã: com.whatsapp, com.instagram.android,
            https://play.google.com/store/apps/details?id=ru.kinopoisk</div>

        <div class="button-group">
            <button id="testBtn" onclick="testAPI()">
                <span id="testText">üß™ –¢–µ—Å—Ç API</span>
            </button>
            <button id="scrapeBtn" onclick="scrapeReviews()">
                <span id="scrapeText">üì• –°–æ–±—Ä–∞—Ç—å –æ—Ç–∑—ã–≤—ã</span>
            </button>
        </div>

        <div id="result" class="info">
            –ù–∞–∂–º–∏—Ç–µ "–¢–µ—Å—Ç API" –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
        </div>
    </div>

    <script>
        const urlInput = document.getElementById('urlInput');
        const testBtn = document.getElementById('testBtn');
        const scrapeBtn = document.getElementById('scrapeBtn');
        const testText = document.getElementById('testText');
        const scrapeText = document.getElementById('scrapeText');
        const resultDiv = document.getElementById('result');

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        function showResult(message, type = 'info') {
            resultDiv.textContent = message;
            resultDiv.className = type;
        }

        // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏ –≤–æ –≤—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞
        function setLoading(loading) {
            testBtn.disabled = loading;
            scrapeBtn.disabled = loading;

            if (loading) {
                testText.innerHTML = '<div class="loading"></div> –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ...';
                scrapeText.innerHTML = '<div class="loading"></div> –ó–∞–≥—Ä—É–∑–∫–∞...';
            } else {
                testText.textContent = 'üß™ –¢–µ—Å—Ç API';
                scrapeText.textContent = 'üì• –°–æ–±—Ä–∞—Ç—å –æ—Ç–∑—ã–≤—ã';
            }
        }

        // –¢–µ—Å—Ç–∏—Ä—É–µ–º API
        async function testAPI() {
            setLoading(true);
            showResult('–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ API...', 'info');

            try {
                // –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ –ø—É—Ç–∏ API
                // *** –ò–ó–ú–ï–ù–ò–¢–¨ –ó–î–ï–°–¨ ***
                const apiPaths = ['/scrapper', '/api/scraper', '/api', '/api/'];

                for (const path of apiPaths) {
                    try {
                        const response = await fetch(path);

                        if (response.ok) {
                            const data = await response.json();
                            showResult(
                                `‚úÖ API —Ä–∞–±–æ—Ç–∞–µ—Ç!\n\n` +
                                `–°–µ—Ä–≤–∏—Å: ${data.service}\n` +
                                `–í–µ—Ä—Å–∏—è: ${data.version}\n` +
                                `–°–æ–æ–±—â–µ–Ω–∏–µ: ${data.message}`,
                                'success'
                            );
                            return; // –£—Å–ø–µ—à–Ω–æ, –≤—ã—Ö–æ–¥–∏–º
                        }
                    } catch (e) {
                        // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–π –ø—É—Ç—å
                        continue;
                    }
                }

                // –ï—Å–ª–∏ –Ω–∏ –æ–¥–∏–Ω –ø—É—Ç—å –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª
                showResult('‚ùå API –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç. –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:\n1. –§—É–Ω–∫—Ü–∏—è –Ω–µ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–∞\n2. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—É—Ç—å\n3. –û—à–∏–±–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ', 'error');

            } catch (error) {
                showResult(`‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`, 'error');
            } finally {
                setLoading(false);
            }
        }

        // –°–æ–±–∏—Ä–∞–µ–º –æ—Ç–∑—ã–≤—ã
        async function scrapeReviews() {
            const url = urlInput.value.trim();

            if (!url) {
                showResult('‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ', 'error');
                return;
            }

            setLoading(true);
            showResult('–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞...', 'info');

            try {
                // –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ –ø—É—Ç–∏
                // *** –ò–ó–ú–ï–ù–ò–¢–¨ –ó–î–ï–°–¨ ***
                const apiPaths = ['/scrapper', '/api/scraper', '/api', '/api/'];
                let success = false;

                for (const path of apiPaths) {
                    try {
                        const response = await fetch(path, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({ url: url })
                        });

                        if (response.ok) {
                            const contentType = response.headers.get('content-type') || '';

                            if (contentType.includes('text/csv')) {
                                // –°–∫–∞—á–∏–≤–∞–µ–º CSV
                                const blob = await response.blob();
                                const downloadUrl = window.URL.createObjectURL(blob);

                                // –ü–æ–ª—É—á–∞–µ–º –∏–º—è —Ñ–∞–π–ª–∞
                                const disposition = response.headers.get('content-disposition');
                                const filename = (disposition && disposition.match(/filename="(.+)"/))
                                    ? disposition.match(/filename="(.+)"/)[1]
                                    : 'reviews.csv';

                                // –°–æ–∑–¥–∞–µ–º —Å—Å—ã–ª–∫—É –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
                                const a = document.createElement('a');
                                a.href = downloadUrl;
                                a.download = filename;
                                document.body.appendChild(a);
                                a.click();
                                a.remove();
                                window.URL.revokeObjectURL(downloadUrl);

                                showResult(`‚úÖ –§–∞–π–ª "${filename}" —É—Å–ø–µ—à–Ω–æ —Å–∫–∞—á–∞–Ω!`, 'success');
                                success = true;
                                break;
                            } else {
                                const text = await response.text();
                                showResult(`‚úÖ –û—Ç–≤–µ—Ç: ${text.substring(0, 200)}`, 'success');
                                success = true;
                                break;
                            }
                        }
                    } catch (e) {
                        // –ü—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â–∏–π –ø—É—Ç—å
                        continue;
                    }
                }

                if (!success) {
                    showResult('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞', 'error');
                }

            } catch (error) {
                showResult(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
            } finally {
                setLoading(false);
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            setTimeout(testAPI, 1000);
        });

        // Enter –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
        urlInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !testBtn.disabled) {
                scrapeReviews();
            }
        });
    </script>
</body>

</html>